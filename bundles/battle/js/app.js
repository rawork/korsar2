webpackJsonp([1],{0:function(t,e){},"1jNW":function(t,e){},Fnt6:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=s("7+uW"),r=s("DmT9"),a=s.n(r),o=s("hMcO"),c=s.n(o),l={props:{status:{type:Boolean,default:!0},rotation:{type:Boolean,default:!0},size:{type:Number,default:30},depth:{type:Number,default:3},speed:{type:Number,default:1},color:{type:String,default:"#6589b6"}},data:function(){return{rotationAnimations:["forward","backward"],sizeUnits:"px",timeUnits:"s"}},computed:{rotationDirection:function(){return this.rotation?this.rotationAnimations[0]:this.rotationAnimations[1]},spinnerSize:function(){return this.size+this.sizeUnits},spinnerDepth:function(){return this.depth+this.sizeUnits},spinnerSpeed:function(){return this.speed+this.timeUnits},spinnerStyle:function(){return{borderTopColor:this.hexToRGB(this.color,.15),borderRightColor:this.hexToRGB(this.color,.15),borderBottomColor:this.hexToRGB(this.color,.15),borderLeftColor:this.color,width:this.spinnerSize,height:this.spinnerSize,borderWidth:this.spinnerDepth,animationName:this.rotationDirection,animationDuration:this.spinnerSpeed}}},methods:{hexToRGB:function(t,e){var s=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16);return e?"rgba("+s+", "+n+", "+i+", "+e+")":"rgb("+s+", "+n+", "+i+")"}}},u={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{directives:[{name:"show",rawName:"v-show",value:this.status,expression:"status"}],staticClass:"sl-spinner",style:this.spinnerStyle})},staticRenderFns:[]},h={components:{Spinner:s("VU/8")(l,u,!1,function(t){s("Fnt6")},null,null).exports}},m={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"text-align":"center"}},[e("h2",{staticClass:"init-message"},[this._v("Игра загружается, подождите...")]),this._v(" "),e("spinner",{attrs:{size:40,depth:2,color:"#f1f1f1",speed:1}})],1)},staticRenderFns:[]},d=s("VU/8")(h,m,!1,null,null,null).exports,f={computed:{time:function(){var t=new Date(1e3*this.$store.state.startTime);return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()}},methods:{reloadPage:function(){window.location.reload()}}},v={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("h2",{staticClass:"before-message"},[this._v("Время начала игры"),e("br"),this._v(this._s(this.time))]),e("br"),e("button",{staticClass:"btn",on:{click:this.reloadPage}},[this._v("Обновить страницу")])])},staticRenderFns:[]},_=s("VU/8")(f,v,!1,null,null,null).exports,p={},g={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{staticClass:"end-message"},[this._v("Игра завершена."),e("br"),this._v("Результаты будут объявлены позже.")])}]},S=s("VU/8")(p,g,!1,null,null,null).exports,w=s("fZjL"),E=s.n(w),C={computed:{timerDisplay:function(){return 0===E()(this.$store.state.timer).length&&this.$store.state.timer.constructor===Object?"":this.$store.state.timer.minutes+":"+(this.$store.state.timer.seconds>9?this.$store.state.timer.seconds:"0"+this.$store.state.timer.seconds)}}},T={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"timer"},[this._v(this._s(this.timerDisplay))])},staticRenderFns:[]},M=s("VU/8")(C,T,!1,null,null,null).exports,b={computed:{timer:function(){return this.$store.state.question.timer},question:function(){return this.$store.state.question.question},activeClass:function(){return this.$store.state.question.timer>0?"active":""},answer:{get:function(){return this.$store.state.question.answer},set:function(t){this.$store.commit("question/SET_ANSWER",t)}}},methods:{setAnswer:function(t,e){this.$store.commit("question/SET_ANSWER",e)},onSubmit:function(){this.$store.dispatch("question/saveAnswer")}}},$={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal",class:[t.activeClass]},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"answer-timer"},[t._v(t._s(t.timer))]),t._v(" "),s("div",{staticClass:"question"},[t._v(t._s(t.question.question))]),t._v(" "),s("div",{staticClass:"answers"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.answer,expression:"answer"}],attrs:{type:"radio",id:"answer_1",value:"1"},domProps:{checked:t._q(t.answer,"1")},on:{change:function(e){t.answer="1"}}}),t._v(" "),s("label",{attrs:{for:"answer_1",click:t.setAnswer(1)}},[t._v(t._s(t.question.answer1))]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.answer,expression:"answer"}],attrs:{type:"radio",id:"answer_2",value:"2"},domProps:{checked:t._q(t.answer,"2")},on:{change:function(e){t.answer="2"}}}),t._v(" "),s("label",{attrs:{for:"answer_2",click:t.setAnswer(2)}},[t._v(t._s(t.question.answer2))]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.answer,expression:"answer"}],attrs:{type:"radio",id:"answer_3",value:"3"},domProps:{checked:t._q(t.answer,"3")},on:{change:function(e){t.answer="3"}}}),t._v(" "),s("label",{attrs:{for:"answer_3",click:t.setAnswer(3)}},[t._v(t._s(t.question.answer3))])]),t._v("\n            "+t._s(t.answer)+"\n            "),s("button",{staticClass:"btn",attrs:{click:t.onSubmit}},[t._v("Ответить")])])])])},staticRenderFns:[]},A=s("VU/8")(b,$,!1,null,null,null).exports,R={computed:{timerShot:function(){return this.$store.state.timerShot}}},N={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{directives:[{name:"show",rawName:"v-show",value:this.timerShot,expression:"timerShot"}],staticClass:"user-panel"},[this._v("Ваш ход, торопитесь выбрать клетку "+this._s(this.timerShot))])},staticRenderFns:[]},k=s("VU/8")(R,N,!1,null,null,null).exports,U={props:["team"],computed:{isOver:function(){return this.team.dead>=6},gamerClass:function(){return"gamer"+this.team.num},shipClass:function(){return"gamer_"+this.team.color}}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"gamer",class:[this.gamerClass,{killed:this.isOver}]},[e("div",{staticClass:"ship",class:[this.shipClass]}),this._v(" "),e("div",{staticClass:"info"},[e("span",{staticClass:"dead"},[this._v(this._s(this.team.dead)+" сбито")]),this._v(",\n        "),e("span",{staticClass:"alive"},[this._v(this._s(this.team.alive)+" живо")])]),this._v(" "),e("img",{staticClass:"flag",attrs:{src:this.team.flag}}),this._v(" "),e("div",{staticClass:"name"},[this._v(this._s(this.team.name))])])},staticRenderFns:[]},D={computed:{teams:function(){return this.$store.state.teams}},components:{User:s("VU/8")(U,x,!1,null,null,null).exports}},F={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[this._l(this.teams,function(t){return e("User",{key:t.shooter_id,attrs:{team:t}})}),this._v(" "),e("div",{staticClass:"arrow arrow1"}),this._v(" "),e("div",{staticClass:"arrow arrow2"}),this._v(" "),e("div",{staticClass:"arrow arrow3"}),this._v(" "),e("div",{staticClass:"mark-red"}),this._v(" "),e("div",{staticClass:"mark-green"}),this._v(" "),e("div",{staticClass:"mark-brown"})],2)},staticRenderFns:[]},q=s("VU/8")(D,F,!1,null,null,null).exports,y={props:["cell"],computed:{cellClass:function(){return"cell"+this.cell.name},activeClass:function(){return this.cell.type+(""===this.cell.type&&this.$store.state.isShooter?" active":"")},isShooter:function(){return this.$store.state.isShooter&&""===this.cell.type}},methods:{onClick:function(){this.$store.dispatch("openQuestion",this.cell.name)}}},I={render:function(){var t=this.$createElement,e=this._self._c||t;return this.isShooter?e("div",{staticClass:"cell",class:[this.cellClass,this.activeCLass],on:{click:this.onClick}}):e("div",{staticClass:"cell",class:[this.cellClass,this.activeCLass]})},staticRenderFns:[]},O={computed:{field:function(){return this.$store.state.field}},components:{Cell:s("VU/8")(y,I,!1,null,null,null).exports}},V={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"battlefield"}),this._v(" "),this._l(this.field,function(t){return e("Cell",{key:t.id,attrs:{cell:t}})})],2)},staticRenderFns:[]},G=s("VU/8")(O,V,!1,null,null,null).exports,W={props:["message"],name:"message"},B={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",[e("a",{attrs:{title:this.message.fullname,href:"#"}},[this._v(this._s(this.message.name))]),this._v(":")]),this._v(" "+this._s(this.message.message)+"\n")])},staticRenderFns:[]},L=s("VU/8")(W,B,!1,null,null,null).exports,z=s("Dd8w"),P=s.n(z),Q=s("NYxO"),j="SET_NEW_MESSAGE",H={name:"chat-form",computed:P()({},Object(Q.b)({newMessage:function(t){return t.chat.newMessage}})),methods:{onSubmit:function(){var t=this.$store.state.chat.newMessage;t&&this.$socket.emit("newMessage",t)},updateNewMessage:function(t){this.$store.commit("chat/"+j,t.target.value)}}},K={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{on:{submit:function(e){e.preventDefault(),t.onSubmit(e)}}},[s("input",{attrs:{autofocus:"",placeholder:"Добавить сообщение"},domProps:{value:t.newMessage},on:{input:t.updateNewMessage}}),t._v(" "),s("button",{staticClass:"btn",attrs:{type:"submit"}},[t._v("Отправить")])])},staticRenderFns:[]},X={computed:{messages:function(){return this.$store.state.chat.messages}},components:{Message:L,ChatForm:s("VU/8")(H,K,!1,null,null,null).exports}},Y={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chat-app"},[e("div",{staticClass:"message-container"},this._l(this.messages,function(t){return e("message",{key:t.id,attrs:{message:t}})})),this._v(" "),e("chat-form")],1)},staticRenderFns:[]},J={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"connection-panel"},[this.isConnected?e("p",[this._v("Вы подключены к игре")]):this._e()])},staticRenderFns:[]},Z={name:"gamescreen",components:{Timer:M,Question:A,ShotTimer:k,UserList:q,Field:G,Chat:s("VU/8")(X,Y,!1,null,null,null).exports,SocketBlock:s("VU/8")({computed:{socketMessage:function(){return this.$store.state.socketMessage},isConnected:function(){return this.$store.state.isConnected}}},J,!1,null,null,null).exports},computed:{isAnswered:function(){return this.$store.state.isAnswered}}},tt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("Timer"),this._v(" "),e("UserList"),this._v(" "),e("ShotTimer"),this._v(" "),e("Field"),this._v(" "),e("Chat"),this._v(" "),e("Question"),this._v(" "),e("SocketBlock")],1)},staticRenderFns:[]},et={computed:{error:function(){return this.$store.state.error}}},st={render:function(){var t=this.$createElement;return(this._self._c||t)("h2",{staticClass:"init-message"},[this._v(this._s(this.error))])},staticRenderFns:[]},nt={name:"app",components:{InitScreen:d,BeforeScreen:_,AfterScreen:S,GameScreen:s("VU/8")(Z,tt,!1,null,null,null).exports,ErrorScreen:s("VU/8")(et,st,!1,null,null,null).exports},computed:{status:function(){return this.$store.state.status}}},it={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"battle-app relative"},["init"===this.status?e("InitScreen"):"error"===this.status?e("ErrorScreen"):"before"===this.status?e("BeforeScreen"):"after"===this.status?e("AfterScreen"):e("GameScreen")],1)},staticRenderFns:[]},rt=s("VU/8")(nt,it,!1,function(t){s("1jNW")},null,null).exports,at=s("bOdI"),ot=s.n(at),ct="SET_STATUS",lt="SET_TIMER",ut="SET_START_TIME",ht="SET_ERROR",mt=(n={},ot()(n,ct,function(t,e){t.status=e}),ot()(n,lt,function(t,e){t.timer=e}),ot()(n,ut,function(t,e){t.startTime=e}),ot()(n,"SET_DURATION",function(t,e){t.duration=e}),ot()(n,ht,function(t,e){t.error=e,t.status="error"}),ot()(n,"SET_TEAMS",function(t,e){t.teams=e}),ot()(n,"SET_FIELD",function(t,e){t.field=e}),ot()(n,"SOCKET_CONNECT",function(t){t.isConnected=!0}),ot()(n,"SOCKET_DISCONNECT",function(t){t.isConnected=!1}),ot()(n,"SOCKET_MESSAGE_CHANNEL",function(t,e){t.socketMessage=e}),ot()(n,"SOCKET_NEW_MESSAGE",function(t,e){var s=t.chat.messages.length+1;t.chat.messages.push({id:s,name:"name"+Math.floor(9*Math.random())+1,fullname:"fullname1",message:e}),t.chat.newMessage=""}),n),dt=s("mtWM"),ft=s.n(dt),vt="/api/battle/data";ft.a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var _t,pt,gt={getData:function(t,e){ft.a.get(vt+"?_="+(new Date).getTime()).then(function(e){return t(e)}).catch(function(t){return e(t)})},getQuestion:function(t,e){ft.a.get("/api/battle/question?_="+(new Date).getTime()).then(function(e){return t(e)}).catch(function(t){return e(t)})},setAnswer:function(t,e,s){ft.a.post(vt,{answer:t}).then(function(t){return e(t)}).catch(function(t){return s(t)})},setShooter:function(t,e,s){ft.a.post(vt,{answer:t}).then(function(t){return e(t)}).catch(function(t){return s(t)})},setMoney:function(t,e,s){ft.a.post(vt,{answer:t}).then(function(t){return e(t)}).catch(function(t){return s(t)})},getMessages:function(t,e){ft.a.get("/api/battle/messages?_="+(new Date).getTime()).then(function(e){return t(e)}).catch(function(t){return e(t)})},addMessage:function(t,e,s){ft.a.post("/api/battle/message",{message:t}).then(function(t){return e(t)}).catch(function(t){return s(t)})}},St=void 0,wt=void 0,Et={initGame:function(t){t.dispatch;var e=t.commit,s=t.state;gt.getData(function(t){console.log(t.data.teams),t.data.error?e(ht,t.data.error):(e(ut,t.data.timer.start),e("SET_DURATION",t.data.timer.duration),e("SET_TEAMS",t.data.teams),e("SET_FIELD",t.data.field),St=setInterval(function(){var t=s.startTime,n=s.startTime+60*s.duration,i=Math.ceil((new Date).getTime()/1e3);if(i>=n)clearInterval(St),e(ct,"after");else if(i<t)e(ct,"before");else{var r=n-i,a=Math.floor(r/60);r=Math.ceil(r-60*a),e(lt,{minutes:a,seconds:r}),"error"!==s.status&&e(ct,"game")}},1e3))},function(t){console.log(t),e(ht,"Ошибка инициализации игры, обратитесь к администатору")})},shoot:function(t){t.commit,t.state},setShooter:function(t){var e=t.commit,s=t.state;wt=setInterval(function(){var t=s.shotStartTime,n=s.startTime+s.shotDuration,i=Math.ceil((new Date).getTime()/1e3);if(i>=n)clearInterval(wt),e(ct,"after");else if(i<t)e(ct,"before");else{var r=n-i,a=Math.floor(r/60);r=Math.ceil(r-60*a),e(lt,{minutes:a,seconds:r}),"error"!==s.status&&e(ct,"game")}},1e3)},socket_messageChannel:function(t,e){t.commit("SOCKET_MESSAGE_CHANNEL",e)},socket_newMessage:function(t,e){t.commit("SOCKET_NEW_MESSAGE",e)}},Ct={namespaced:!0,state:{messages:[],newMessage:"",isScrolled:!1},mutations:(_t={},ot()(_t,j,function(t,e){t.newMessage=e}),ot()(_t,"SET_MESSAGES",function(t,e){t.messages=e}),ot()(_t,"ADD_MESSAGE",function(t,e){t.messages.push(e)}),_t),actions:{getMessages:function(t){var e=t.commit;gt.getMessages(function(t){t.data.error?e(ht,t.data.error,{root:!0}):e("SET_MESSAGES",t.data.messages)},function(t){console.log(t)})},addMessage:function(t,e){var s=t.commit;gt.addMessage(e,function(t){t.data.error?s(ht,t.data.error,{root:!0}):s(j,"")},function(t){console.log(t)})}}},Tt="SET_TIMER",Mt="SET_START_TIME",bt="SET_QUESTION",$t=void 0,At={namespaced:!0,state:{question:{},timer:0,startTime:0,duration:25,answer:null},mutations:(pt={},ot()(pt,bt,function(t,e){t.question=e}),ot()(pt,"SET_ANSWER",function(t,e){t.answer=e}),ot()(pt,Tt,function(t,e){t.timer=e}),ot()(pt,Mt,function(t,e){t.startTime=e}),pt),actions:{getQuestion:function(t){var e=t.commit,s=t.state;gt.getQuestion(function(t){t.data.error?e(ht,t.data.error,{root:!0}):(e(Mt,Math.ceil((new Date).getTime()/1e3)),e(bt,t.data.question),$t=setInterval(function(){var t=s.startTime+s.duration,n=Math.ceil((new Date).getTime()/1e3);if(n>=t)clearInterval($t),e(bt,{}),e(Tt,0);else{e(Tt,t-n)}},1e3))},function(t){console.log(t)})},sendAnswer:function(t){var e=t.commit;t.state;clearInterval($t),gt.sendAnswer(function(t){t.data.error?e(ht,t.data.error,{root:!0}):e(Tt,0)},function(t){console.log(t)})}}};i.a.use(Q.a);var Rt=new Q.a.Store({state:{status:"init",error:"",timer:{},isShooter:!1,startTime:0,duration:0,user:null,shooter:0,shooter_timer:0,battle:0,teams:[],field:[],timerShot:20,shotDuration:30,isConnected:!1,socketMessage:""},mutations:mt,actions:Et,modules:{chat:Ct,question:At}});s.d(e,"SocketInstance",function(){return Nt});var Nt=a()("http://localhost:8080");i.a.use(c.a,Nt,Rt),i.a.config.productionTip=!1,new i.a({el:"#battle-app",store:Rt,render:function(t){return t(rt)},components:{App:rt},mounted:function(){Rt.dispatch("initGame"),Rt.dispatch("chat/getMessages")}})}},["NHnr"]);
//# sourceMappingURL=app.js.map